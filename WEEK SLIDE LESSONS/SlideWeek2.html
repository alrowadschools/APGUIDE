<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.10.0/dist/pptxgen.bundle.js"></script>
    <script src="https://unpkg.com/mammoth@1.4.8/mammoth.browser.min.js"></script>
    <link rel="stylesheet" href="APCSP PDF WEEK FILES/SCRIPTS/weekstyles.css">
    <title>PPT EXTRACTOR - WEEK 2</title>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader-content">
            <div class="loader">
                <div class="loader-circle"></div>
                <div class="loader-circle"></div>
                <div class="loader-inner">PPT</div>
            </div>
            <div class="loader-text">Loading Content...</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js"></script>
    <script src="https://cozmo.github.io/jsQR/jsQR.js"></script>

    <!-- Modal for extracted content -->
    <div class="modal" id="extracted-content-modal">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-pages-container" id="modal-pages-container">
                    <!-- Pages will be inserted here -->
                </div>
            </div>
            <div class="modal-nav" style="position: relative; display: flex; align-items: center;">
                <!-- Left group -->
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="modal-nav-btn" id="modal-prev-btn" onclick="prevModalPage()">‚óÄÔ∏è</button>
                    <div class="modal-page-info" id="modal-page-info">SLIDE 1 of 1</div>
                    
                    <!-- Bottom Navigation Bar -->
                    <div class="container-items" style="margin-bottom: 0px;height:0px;">
                        <button class="item-color" style="--color: #facc15" aria-color="üìöWK-2:Visual" onclick="showIframe('https://dannyvanpoucke.be/wp-content/uploads/2020/12/surface_Sinc2D_25_Ens.gif')"></button>
                        <button class="item-color" style="--color: #e11d48" aria-color="üìöWK-2:WHITE BOARD" onclick="showIframe('https://wbo.ophir.dev/boards/anonymous')"></button>
                        <button class="item-color" style="--color: #facc15" aria-color="üìöWK-2:Lesson Video" onclick="showIframe('https://www.youtube.com/embed/7_SX4pTr3gk')"></button>
                        <button class="item-color" style="--color: #f472b6" aria-color="üìöWK-2:JOIN MY QUIZZ" onclick="showIframe('https://wayground.com/join?gc=52065078&source=liveDashboard')"></button>
                        <button class="item-color" style="--color: #84cc16" aria-color="üìöWK-2:Practice Test" onclick="openTest()"></button>
                    </div>
                </div>

                <!-- Close button (slightly left of center) -->
                <button class="modal-close" onclick="closeModal()" style="position: absolute; left: 90%; transform: translateX(-65%);background:red;">‚úñÔ∏è</button>

                <!-- Right button -->
                <button class="modal-nav-btn" id="modal-next-btn" onclick="nextModalPage()">‚ñ∂Ô∏è</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Week Loading Button -->
        <div class="action-buttons">
            <!-- Input box (hidden) -->
            <input type="text" id="WeekNoInput" placeholder="Enter Week No" style="margin-bottom: 8px; width: 100px; padding: 4px;display:none;">
            
            <!-- Week 2 Load Button -->
            <button class="btn-drive" onclick="loadWeekPDF(2)">WEEK 2</button>
        </div>

        <!-- Upload and General Extract Button -->
        <div class="action-buttons">
            <button class="btn-drive" onclick="loadPCPDF()">UPLOADüìÅ</button>
            <button class="btn-view-extracted" id="general-extract-btn" onclick="extractGeneralPDF()" disabled>EXTRACT</button>
        </div>

        <!-- PDF Viewer -->
        <div class="pdf-viewer-container" id="pdf-viewer-container" style="display:none;">
            <div class="viewer-header" style="display:none;">
                <div class="viewer-title" style="display:none;">
                    <div class="extraction-status" id="extraction-status">
                        <div class="status-content">
                            <div class="status-spinner"></div>
                            <div class="status-text" id="status-text">Extracting content...</div>
                            <div class="status-progress">
                                <div class="status-bar" id="status-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="viewer-controls">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomOut()">-</button>
                        <span class="zoom-level" id="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                    </div>
                    <button class="btn-viewer" onclick="prevPage()">
                        <svg width="16" height="16" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
                        </svg>
                        Prev
                    </button>
                    <span>Page: <input type="number" id="current-page" class="page-input" min="1" value="1" onchange="goToPage(this.value)"></span>
                    <span id="total-pages">/ 1</span>
                    <button class="btn-viewer" onclick="nextPage()">
                        Next
                        <svg width="16" height="16" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
                        </svg>
                    </button>
                    <button class="btn-viewer" onclick="closeViewer()">
                        <svg width="16" height="16" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                        </svg>
                        Close
                    </button>
                </div>
            </div>
            <div class="pdf-js-viewer-container" style="display:none;">
                <div id="pdf-canvas-container" style="display:none;"></div>
            </div>
        </div>

        <!-- Drop zone -->
        <div class="drop-zone" id="drop-zone" style="display:none;">
            <div class="drop-zone-icon">üìÅ</div>
            <div class="drop-zone-text">Drop your PDF here or click to browse</div>
            <div class="drop-zone-hint">Supports PDF files up to 50MB</div>
            <input type="file" id="file-input" accept=".pdf,application/pdf">
        </div>

        <!-- Week 2 Extract Button -->
        <div class="action-buttons">
            <button class="btn-view-extracted" id="extract-week-2-btn" onclick="extractWeek(2)" disabled>Extract Week 2</button>
        </div>

        <div class="stats-bar" id="stats-bar" style="display: none;">
            <div class="stat-item" style="display: none;">
                <div class="stat-value" id="stat-pages" style="display: none;">0</div>
                <div class="stat-label" style="display:none;">Pages</div>
            </div>
            <div class="stat-item" style="display: none;">
                <div class="stat-value" id="stat-text" style="display: none;">0</div>
                <div class="stat-label" style="display:none;">Text Blocks</div>
            </div>
            <div class="stat-item" style="display: none;">
                <div class="stat-value" id="stat-images" style="display: none;">0</div>
                <div class="stat-label" style="display:none;">Images</div>
            </div>
        </div>

        <div id="content-container" style="display:none;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

    <!-- Single consolidated script file -->
    <script src="APCSP PDF WEEK FILES/SCRIPTS/GeneralSlides.js"></script>

    <script>
        // Auto-click WEEK 2 button when page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Small delay to ensure all scripts are loaded
            setTimeout(() => {
                const week2Button = document.querySelector('[onclick="loadWeekPDF(2)"]');
                if (week2Button) {
                    week2Button.click();
                }
            }, 1000);
        });
    </script>
<script>
function ExtractPPT(slidesData) {
    const pptx = new PptxGenJS();

    // Set custom slide size: 16 x 6 inches
    pptx.defineLayout({ name: "Custom16x6", width: 16, height: 6 });
    pptx.layout = "Custom16x6";

    const today = new Date();
    const dateStr = today.toLocaleDateString(); // e.g., "1/23/2026"

    slidesData.forEach((slideItem, index) => {
        const slide = pptx.addSlide();

        // --- Top Heading Shape ---
        if (slideItem.heading) {
            slide.addText(slideItem.heading, {
                x: 0.0, y: 0.0, w: 7.0, h: 0.7,
                fontSize: 28,
                bold: true,
                color: "2c3e50",
                valign: "middle",
                align: "center",
                fill: { color: "DDA0F7" }, // light purple
                margin: 0.1,
                borderRadius: 4
            });
        }

        // --- Left Column Background Shape (DDA0F7, NO LINE) ---
        slide.addShape(pptx.shapes.RECTANGLE, {  // plain rectangle
            x: 0.8, y: 0.7, w: 6.2, h: 5.0,
            fill: { color: "DDA0F7" }, // purple background
            line: null                 // no border line
        });

        // --- Left Column Text ---
        slide.addText(slideItem.text || "No text available", {
            x: 0.2, y: 0.7, w: 6.5, h: 4.9,
            fontSize: 22,
            color: "363636",
            valign: "top",
            align: "justify",
            margin: 0.1,
            bold: true,
            fill: { color: "FFFFFF" },
            shape: pptx.shapes.ROUNDED_RECTANGLE
        });

        // --- Right Column Image ---
        if (slideItem.image) {
            slide.addImage({
                x: 7, y: 0.0, w: 9, h: 6.0,
                data: slideItem.image
            });
        }

        // --- Bottom Footer Shape with Date & Slide Number ---
        slide.addText(`Date: ${dateStr}   |   Slide: ${index + 1}`, {
            x: 0.0, y: 5.6, w: 7.0, h: 0.4,
            fontSize: 18,
            bold: true,
            color: "2c3e50",
            valign: "middle",
            align: "center",
            fill: { color: "DDA0F7" }, // same light purple
            margin: 0.1,
            borderRadius: 4
        });
    });

    pptx.writeFile("GeneratedSlides.pptx");
}

function downloadImageInModal(pageNum, index) {
    const slidesData = [];
    
    // Only select elements inside the modal
    const modal = document.getElementById("extracted-content-modal");
    const textBlocks = modal.querySelectorAll(".text-block");
    const imageBlocks = modal.querySelectorAll(".image-block");
    
    // The modal should have equal number of text and image blocks (one per page)
    const totalSlides = Math.min(textBlocks.length, imageBlocks.length);
    
    for (let i = 0; i < totalSlides; i++) {
        const textDiv = textBlocks[i];
        const imageDiv = imageBlocks[i];
        
        let heading = "";
        
        // Find the div that contains the actual heading text (flex:1)
        const headingDiv = textDiv?.querySelector("div[style*='flex: 1']") || null;
        if (headingDiv) {
            heading = headingDiv.innerText.trim(); // Only heading text, no icons
        }
        
        // Get the 3 sentences text content
        const textContent = textDiv?.querySelector(".text-content")?.innerText || "";
        const imageSrc = imageDiv?.querySelector("img")?.src || null;
        
        // Only add slide if we have heading (which we should for each page)
        if (heading) {
            slidesData.push({
                heading: heading,
                text: textContent,
                image: imageSrc
            });
        }
    }

    // Generate PPTX
    if (slidesData.length > 0) {
        ExtractPPT(slidesData);
    } else {
        alert("No slides to download!");
    }
}
</script>

</body>
</html>
